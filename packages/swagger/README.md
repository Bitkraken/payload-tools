[![snyk](https://snyk.io/test/github/teunmooij/payload-tools/badge.svg)](https://snyk.io/test/github/teunmooij/payload-tools)
[![npm version](https://badge.fury.io/js/payload-swagger.svg)](https://badge.fury.io/js/payload-swagger)

# payload-swagger

Swagger plugin for payload cms:

- generate openAPI 3 documentation from your payload config
- adds routes for:
  - openAPI document
  - Swagger UI
  - LICENSE file, if available

`payload-swagger` uses `payload-openapi`, which documents ALL your payload openapi endpoints and includes:

- collection endpoints
- global endpoints
- custom endpoints
- authentication endpoints
- preferences endpoints
- fully typed schema definitions for all requests, parameters and responses
- authentication requirements for all your endpoints
- extension points to merge your custom openapi definitions into the schema

Alternatives:

- [payload-openapi](https://www.npmjs.com/package/payload-openapi) if you just want to openapi document
- [create-payload-api-docs](https://www.npmjs.com/package/create-payload-api-docs) if you want a cli version (eg to build the openapi doc in your build pipeline)

## Installation

With yarn:

```shell
yarn add payload-swagger
```

With npm:

```shell
npm install payload-swagger
```

## Usage

```typescript
import { buildConfig } from 'payload/config';
import path from 'path';
import { swagger } from 'payload-swagger';

export default buildConfig({
  plugins: [
    swagger({
      /* see options section */
    }),
  ],
  // The rest of your config goes here
});
```

## Extend the openAPI document

The openAPI document generated by `payload-swagger` includes information from the following external sources:

- `package.json`: `payload-swagger` uses the information in the fields shown below. In `openapi` a partial openapi document can be included;

```json
{
  "name": "my payload cms",
  "version": "1.2.3",
  "description": "My awesome cms",
  "license": "MIT",
  "openapi": {}
}
```

- `.openapi`: optional file with partial openapi document in JSON format.

The data from all these source is recursively merged into the final document.

## Options

`payload-swagger` has the following options:

```typescript
interface Options {
  /**
   * By default the access functions on all collections in the config are called to determine
   * the access level of the operations.
   * Provide an array of collection slugs to disable this for the given collections,
   * or `true` to disable for all.
   */
  disableAccessAnalysis?: boolean | string[];

  /**
   * Exclude parts of the payload config from the openapi document
   */
  exclude?: {
    authPaths?: boolean;
    authCollection?: boolean;
    passwordRecovery: boolean; // default true, set to `false` to include
    preferences?: boolean; // default true, set to `false` to include
    custom?: boolean;
  };

  /**
   * Customize the payload-swagger routes
   */
  routes?: {
    /**
     * Swagger ui route
     * @default /api-docs
     */
    swagger?: string;
    /**
     * Openapi specs route
     * @default /api-docs/specs
     */
    specs?: string;
    /**
     * License route (requires LICENSE file in root of repository or explicit license url in openapi document)
     * @default /api-docs/license
     */
    license?: string;
  };

  /**
   * Swagger ui options (see swagger-ui documentation)
   */
  ui?: Omit<SwaggerUiOptions, 'swaggerUrl' | 'swaggerUrls'>;
}
```

## Version history

See [changelog](./CHANGELOG.md)
